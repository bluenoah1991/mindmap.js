{"version":3,"sources":["../src/Node.js"],"names":["Node","opts","nodes","parentNode","link","line","name","serial","items","linkRadius","gapWidth","gapHeight","container","_createContainer","_addContent","_createHeader","forEach","item","type","_createImage","src","_createParagraph","text","bind","box","element","$","addClass","append","undefined","serialElement","orientation","width","height","x","y","_getLinkPosition","mount","open","radius","scene","addBox","x1","y1","_getConnectionPosition","x2","y2","filter","node","isShow","length","i","child","_calcHeight","startX","centerY","startY","_getLinkExternalPosition","startY_","reset","_adjustLink","_adjustLine","_adjustPosition","setPosition","push","setTimeout","_createLink","_createLine","render","show","switch","getRootNode","hide","close","show_"],"mappings":"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","file":"Node.js","sourcesContent":["import _ from 'lodash';\r\nimport {Box} from 'box.js';\r\n\r\nimport Link from './Link';\r\nimport Line from './Line';\r\n\r\nexport default class Node{\r\n    constructor(opts){\r\n        this.nodes = [];\r\n        this.parentNode = null;\r\n        this.link = null;\r\n        // from parent node to this node\r\n        this.line = null;\r\n\r\n        // Options\r\n        this.opts = opts || {};\r\n        this.name = this.opts.name || '';\r\n        this.serial = this.opts.serial || null;\r\n        this.items = this.opts.items || [];\r\n        this.linkRadius = this.opts.linkRadius || 8;\r\n        this.gapWidth = this.opts.gapWidth || 50;\r\n        this.gapHeight = this.opts.gapHeight || 30;\r\n\r\n        // Build Element\r\n        this.container = this._createContainer();\r\n        this._addContent(this._createHeader(this.name, this.serial));\r\n        _.forEach(this.items, function(item){\r\n            if(item.type == 'image'){\r\n                this._addContent(this._createImage(item.src));\r\n            } else if(item.type == 'paragraph'){\r\n                this._addContent(this._createParagraph(item.text));\r\n            }\r\n        }.bind(this));\r\n        this.box = new Box(this.container);\r\n    }\r\n\r\n    _createContainer(){\r\n        let element = $('<div />');\r\n        element.addClass('mindmap');\r\n        element.addClass('node');\r\n        return element;\r\n    }\r\n\r\n    _addContent(element){\r\n        this.container.append(element);\r\n    }\r\n\r\n    _createHeader(text, serial){\r\n        let element = $('<p />');\r\n        element.addClass('header');\r\n        element.text(text);\r\n        if(serial != undefined){\r\n            let serialElement = $('<span />');\r\n            serialElement.addClass('serial');\r\n            serialElement.text(serial);\r\n            element.append(serialElement);\r\n        }\r\n        return element;\r\n    }\r\n\r\n    // Create Item\r\n\r\n    _createImage(src){\r\n        let element = $('<img />', {\r\n            src: src\r\n        });\r\n        element.addClass('item');\r\n        element.addClass('image');\r\n        return element;\r\n    }\r\n\r\n    _createParagraph(text){\r\n        let element = $('<p />');\r\n        element.addClass('item');\r\n        element.addClass('paragraph');\r\n        element.text(text);\r\n        return element;\r\n    }\r\n\r\n    // Position\r\n\r\n    _getConnectionPosition(orientation = 'left'){\r\n        let width = this.container.width();\r\n        let height = this.container.height();\r\n        if(orientation == 'left'){\r\n            let x = this.box.x;\r\n            let y = this.box.y + height / 2;\r\n            return [x, y];\r\n        }\r\n    }\r\n\r\n    _getLinkPosition(orientation = 'right'){\r\n        let width = this.container.width();\r\n        let height = this.container.height();\r\n        if(orientation == 'right'){\r\n            let x = this.box.x + width + this.linkRadius;\r\n            let y = this.box.y + height / 2;\r\n            return [x, y];\r\n        }\r\n    }\r\n\r\n    _getLinkExternalPosition(orientation = 'right'){\r\n        let [x, y] = this._getLinkPosition(orientation);\r\n        if(orientation == 'right'){\r\n            return [x + this.linkRadius, y];\r\n        }\r\n    }\r\n\r\n    // Create widget\r\n\r\n    _createLink(orientation = 'right'){\r\n        if(this.box.mount && this.link == undefined){\r\n            let [x, y] = this._getLinkPosition(orientation);\r\n            this.link = new Link(this, {\r\n                open: true,\r\n                radius: this.linkRadius\r\n            });\r\n            this.box.scene.addBox(this.link.box, x, y, 0);\r\n        }\r\n    }\r\n\r\n    _createLine(x1, y1, orientation = 'left'){\r\n        if(this.box.mount && this.line == undefined){\r\n            let [x2, y2] = this._getConnectionPosition(orientation);\r\n            this.line = new Line({\r\n                x1: x1, y1: y1,\r\n                x2: x2, y2: y2\r\n            });\r\n            this.box.scene.addBox(this.line.box, 0, 0, -1);\r\n        }\r\n    }\r\n\r\n    // Adjust Position\r\n\r\n    _calcHeight(){\r\n        let height = 0;\r\n        let nodes = _.filter(this.nodes, function(node){\r\n            return node.isShow();\r\n        });\r\n        if(nodes.length > 0){\r\n            for(var i in nodes){\r\n                let child = nodes[i];\r\n                height += child._calcHeight();\r\n            }\r\n            height += (nodes.length - 1) * this.gapHeight;\r\n\r\n        } else {\r\n            height += this.container.height();\r\n        }\r\n        return height;\r\n    }\r\n\r\n    _adjustPosition(){\r\n        let height = this._calcHeight();\r\n        let startX = this.box.x + this.container.width() + this.gapWidth;\r\n        let centerY = this.box.y + this.container.height() / 2;\r\n        let startY = centerY - height / 2;\r\n\r\n        let [x1, y1] = this._getLinkExternalPosition();\r\n        \r\n        for(var i in this.nodes){\r\n            let node = this.nodes[i];\r\n            let startY_ = startY + ((node._calcHeight() - node.container.height()) / 2);\r\n            node.reset(startX, startY_);\r\n            node._adjustLink();\r\n            node._adjustLine(x1, y1);\r\n            node._adjustPosition();\r\n            startY += node._calcHeight() + this.gapHeight;\r\n        }\r\n    }\r\n\r\n    _adjustLink(){\r\n        if(this.link != undefined){\r\n            let [x, y] = this._getLinkPosition();\r\n            this.link.reset(x, y);\r\n        }\r\n    }\r\n\r\n    _adjustLine(x1, y1){\r\n        if(this.line != undefined){\r\n            let [x2, y2] = this._getConnectionPosition();\r\n            this.line.reset(x1, y1, x2, y2);\r\n        }\r\n    }\r\n\r\n    // Publich Methods\r\n\r\n    reset(x, y){\r\n        this.box.setPosition(x, y);\r\n    }\r\n\r\n    addChildNode(node){\r\n        // mount node\r\n        this.nodes.push(node);\r\n        if(!node.box.mount){\r\n            this.box.scene.addBox(node.box, 0, 0, 0);\r\n        }\r\n        node.parentNode = this;\r\n\r\n        setTimeout(function(){\r\n            // create widget\r\n            this._createLink();\r\n            let [x1, y1] = this._getLinkExternalPosition();\r\n            node._createLine(x1, y1);\r\n\r\n            // adjust position\r\n            this._adjustPosition();\r\n            this.box.scene.render();\r\n        }.bind(this), 0);\r\n    }\r\n\r\n    open(){\r\n        for(var i in this.nodes){\r\n            let node = this.nodes[i];\r\n            node.box.show();\r\n            if(node.link != undefined){\r\n                node.link.switch(true);\r\n                node.link.box.show();\r\n            }\r\n            if(node.line != undefined){\r\n                node.line.box.show();\r\n            }\r\n            node.open();\r\n        }\r\n        // adjust position\r\n        this.getRootNode()._adjustPosition();\r\n        this.box.scene.render();\r\n    }\r\n\r\n    close(){\r\n        for(var i in this.nodes){\r\n            let node = this.nodes[i];\r\n            node.box.hide();\r\n            if(node.link != undefined){\r\n                node.link.box.hide();\r\n            }\r\n            if(node.line != undefined){\r\n                node.line.box.hide();\r\n            }\r\n            node.close();\r\n        }\r\n        // adjust position\r\n        this.getRootNode()._adjustPosition();\r\n        this.box.scene.render();\r\n    }\r\n\r\n    isShow(){\r\n        return this.box.show_;\r\n    }\r\n\r\n    getRootNode(){\r\n        if(this.parentNode != undefined){\r\n            return this.parentNode.getRootNode();\r\n        } else {\r\n            return this;\r\n        }\r\n    }\r\n}"]}