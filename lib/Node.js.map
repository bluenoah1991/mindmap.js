{"version":3,"sources":["../src/Node.js"],"names":["Node","opts","nodes","parentNode","link","line","element","$","linkRadius","gapWidth","gapHeight","box","marginTop","parseInt","css","marginBottom","height","orientation","width","_calcElementHeight","x","y","_getLinkPosition","mount","undefined","open","radius","scene","addBox","x1","y1","_getConnectionPosition","x2","y2","filter","node","isShow","length","i","child","_calcHeight","startX","centerY","startY","_getLinkExternalPosition","startY_","reset","_adjustLink","_adjustLine","_adjustPosition","setPosition","push","setTimeout","_createLink","_createLine","render","bind","show","switch","getRootNode","hide","close","show_"],"mappings":"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","file":"Node.js","sourcesContent":["import _ from 'lodash';\r\nimport {Box} from 'box.js';\r\n\r\nimport Link from './Link';\r\nimport Line from './Line';\r\n\r\nexport default class Node{\r\n    constructor(opts){\r\n        this.nodes = [];\r\n        this.parentNode = null;\r\n        this.link = null;\r\n        // from parent node to this node\r\n        this.line = null;\r\n\r\n        // Options\r\n        this.opts = opts || {};\r\n        this.element = this.opts.element || $('<h1>Node</h1>');\r\n        this.linkRadius = this.opts.linkRadius || 8;\r\n        this.gapWidth = this.opts.gapWidth || 50;\r\n        this.gapHeight = this.opts.gapHeight || 30;\r\n        this.box = new Box(this.element);\r\n    }\r\n\r\n    _calcElementHeight(element){\r\n        let marginTop = parseInt(element.css('margin-top'));\r\n        let marginBottom = parseInt(element.css('margin-bottom'));\r\n        let height = element.height();\r\n        return height + marginTop + marginBottom;\r\n    }\r\n\r\n    // Position\r\n\r\n    _getConnectionPosition(orientation = 'left'){\r\n        let width = this.element.width();\r\n        let height = this._calcElementHeight(this.element);\r\n        if(orientation == 'left'){\r\n            let x = this.box.x;\r\n            let y = this.box.y + height / 2;\r\n            return [x, y];\r\n        }\r\n    }\r\n\r\n    _getLinkPosition(orientation = 'right'){\r\n        let width = this.element.width();\r\n        let height = this._calcElementHeight(this.element);\r\n        if(orientation == 'right'){\r\n            let x = this.box.x + width + this.linkRadius;\r\n            let y = this.box.y + height / 2;\r\n            return [x, y];\r\n        }\r\n    }\r\n\r\n    _getLinkExternalPosition(orientation = 'right'){\r\n        let [x, y] = this._getLinkPosition(orientation);\r\n        if(orientation == 'right'){\r\n            return [x + this.linkRadius, y];\r\n        }\r\n    }\r\n\r\n    // Create widget\r\n\r\n    _createLink(orientation = 'right'){\r\n        if(this.box.mount && this.link == undefined){\r\n            let [x, y] = this._getLinkPosition(orientation);\r\n            this.link = new Link(this, {\r\n                open: true,\r\n                radius: this.linkRadius\r\n            });\r\n            this.box.scene.addBox(this.link.box, x, y, 0);\r\n        }\r\n    }\r\n\r\n    _createLine(x1, y1, orientation = 'left'){\r\n        if(this.box.mount && this.line == undefined){\r\n            let [x2, y2] = this._getConnectionPosition(orientation);\r\n            this.line = new Line({\r\n                x1: x1, y1: y1,\r\n                x2: x2, y2: y2\r\n            });\r\n            this.box.scene.addBox(this.line.box, 0, 0, -1);\r\n        }\r\n    }\r\n\r\n    // Adjust Position\r\n\r\n    _calcHeight(){\r\n        let height = 0;\r\n        let nodes = _.filter(this.nodes, function(node){\r\n            return node.isShow();\r\n        });\r\n        if(nodes.length > 0){\r\n            for(var i in nodes){\r\n                let child = nodes[i];\r\n                height += child._calcHeight();\r\n            }\r\n            height += (nodes.length - 1) * this.gapHeight;\r\n\r\n        } else {\r\n            height += this._calcElementHeight(this.element);\r\n        }\r\n        return height;\r\n    }\r\n\r\n    _adjustPosition(){\r\n        let height = this._calcHeight();\r\n        let startX = this.box.x + this.element.width() + this.gapWidth;\r\n        let centerY = this.box.y + this._calcElementHeight(this.element) / 2;\r\n        let startY = centerY - height / 2;\r\n\r\n        let [x1, y1] = this._getLinkExternalPosition();\r\n        \r\n        for(var i in this.nodes){\r\n            let node = this.nodes[i];\r\n            let startY_ = startY + ((node._calcHeight() - this._calcElementHeight(node.element)) / 2);\r\n            node.reset(startX, startY_);\r\n            node._adjustLink();\r\n            node._adjustLine(x1, y1);\r\n            node._adjustPosition();\r\n            startY += node._calcHeight() + this.gapHeight;\r\n        }\r\n    }\r\n\r\n    _adjustLink(){\r\n        if(this.link != undefined){\r\n            let [x, y] = this._getLinkPosition();\r\n            this.link.reset(x, y);\r\n        }\r\n    }\r\n\r\n    _adjustLine(x1, y1){\r\n        if(this.line != undefined){\r\n            let [x2, y2] = this._getConnectionPosition();\r\n            this.line.reset(x1, y1, x2, y2);\r\n        }\r\n    }\r\n\r\n    // Publich Methods\r\n\r\n    reset(x, y){\r\n        this.box.setPosition(x, y);\r\n    }\r\n\r\n    addChildNode(node){\r\n        // mount node\r\n        this.nodes.push(node);\r\n        if(!node.box.mount){\r\n            this.box.scene.addBox(node.box, 0, 0, 0);\r\n        }\r\n        node.parentNode = this;\r\n\r\n        setTimeout(function(){\r\n            // create widget\r\n            this._createLink();\r\n            let [x1, y1] = this._getLinkExternalPosition();\r\n            node._createLine(x1, y1);\r\n\r\n            // adjust position\r\n            this._adjustPosition();\r\n            this.box.scene.render();\r\n        }.bind(this), 0);\r\n    }\r\n\r\n    open(){\r\n        for(var i in this.nodes){\r\n            let node = this.nodes[i];\r\n            node.box.show();\r\n            if(node.line != undefined){\r\n                node.line.box.show();\r\n            }\r\n            if(node.link != undefined){\r\n                node.link.box.show();\r\n                if(node.link.open){\r\n                    node.link.switch(true);\r\n                    node.open();\r\n                }\r\n            }\r\n        }\r\n        // adjust position\r\n        this.getRootNode()._adjustPosition();\r\n        this.box.scene.render();\r\n    }\r\n\r\n    close(){\r\n        for(var i in this.nodes){\r\n            let node = this.nodes[i];\r\n            node.box.hide();\r\n            if(node.link != undefined){\r\n                node.link.box.hide();\r\n            }\r\n            if(node.line != undefined){\r\n                node.line.box.hide();\r\n            }\r\n            node.close();\r\n        }\r\n        // adjust position\r\n        this.getRootNode()._adjustPosition();\r\n        this.box.scene.render();\r\n    }\r\n\r\n    isShow(){\r\n        return this.box.show_;\r\n    }\r\n\r\n    getRootNode(){\r\n        if(this.parentNode != undefined){\r\n            return this.parentNode.getRootNode();\r\n        } else {\r\n            return this;\r\n        }\r\n    }\r\n}"]}